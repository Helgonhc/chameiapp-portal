(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{9631:function(e,s,t){Promise.resolve().then(t.bind(t,770))},770:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var l=t(7437),a=t(2265),r=t(4033),n=t(5922),i=t(3067),o=t(5817),c=t(5790),d=t(1827),x=t(8203),m=t(105),u=t(6704);function h(){let e=(0,r.useRouter)(),[s,t]=(0,a.useState)(!0),[u,h]=(0,a.useState)([]),[b,p]=(0,a.useState)([]),[f,g]=(0,a.useState)("3months"),[j,N]=(0,a.useState)("");async function v(){let{data:{user:s}}=await n.O.auth.getUser();s||e.push("/login")}async function w(){try{let{data:{user:e}}=await n.O.auth.getUser();if(!e)return;let s=n.O.from("service_orders").select("\n          *,\n          technician:profiles!service_orders_technician_id_fkey(full_name)\n        ").eq("status","completed").order("completed_at",{ascending:!1});if("all"!==f){let e="month"===f?1:"3months"===f?3:"6months"===f?6:12,t=new Date;t.setMonth(t.getMonth()-e),s=s.gte("completed_at",t.toISOString())}let{data:t,error:l}=await s;if(l)throw l;h(t||[]),p(t||[])}catch(e){console.error("Erro ao carregar hist\xf3rico:",e)}finally{t(!1)}}(0,a.useEffect)(()=>{v(),w()},[f]),(0,a.useEffect)(()=>{(function(){if(!j){p(u);return}p(u.filter(e=>{var s;return e.title.toLowerCase().includes(j.toLowerCase())||e.order_number.toLowerCase().includes(j.toLowerCase())||(null===(s=e.technician)||void 0===s?void 0:s.full_name.toLowerCase().includes(j.toLowerCase()))}))})()},[u,j]);let y=b.reduce((e,s)=>e+(s.final_cost||0),0),C=b.length>0?y/b.length:0;return s?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[(0,l.jsx)("header",{className:"bg-white/80 backdrop-blur-xl border-b border-slate-200/60 sticky top-0 z-50",children:(0,l.jsx)("div",{className:"max-w-6xl mx-auto px-6 py-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:()=>e.back(),className:"p-2.5 hover:bg-slate-100 rounded-xl transition-all",children:(0,l.jsx)(i.Z,{className:"w-5 h-5 text-slate-700"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-slate-900",children:"Hist\xf3rico de Servi\xe7os"}),(0,l.jsxs)("p",{className:"text-sm text-slate-500",children:[b.length," servi\xe7o",1!==b.length?"s":""," conclu\xeddo",1!==b.length?"s":""]})]})]}),(0,l.jsxs)("button",{onClick:()=>window.print(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-all",children:[(0,l.jsx)(o.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:"Exportar PDF"})]})]})})}),(0,l.jsxs)("main",{className:"max-w-6xl mx-auto px-6 py-8",children:[(0,l.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,l.jsx)(c.Z,{className:"w-5 h-5 text-blue-600"})}),(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Total de Servi\xe7os"})]}),(0,l.jsx)("p",{className:"text-3xl font-bold text-slate-900",children:b.length})]}),(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-xl",children:"\uD83D\uDCB0"})}),(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Valor Total"})]}),(0,l.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:["R$ ",y.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCA"})}),(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Valor M\xe9dio"})]}),(0,l.jsxs)("p",{className:"text-3xl font-bold text-purple-600",children:["R$ ",C.toFixed(2)]})]})]}),u.length>0&&(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-6 mb-8",children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-slate-900 mb-4",children:"Servi\xe7os por M\xeas"}),(0,l.jsx)(m.x1,{data:function(){let e={};return u.forEach(s=>{let t=new Date(s.completed_at).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});e[t]=(e[t]||0)+1}),{labels:Object.keys(e).reverse(),datasets:[{label:"Servi\xe7os Conclu\xeddos",data:Object.values(e).reverse(),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]}}(),options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})]}),(0,l.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-6 mb-6",children:(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(d.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),(0,l.jsx)("input",{type:"text",placeholder:"Buscar por t\xedtulo, n\xfamero ou t\xe9cnico...",value:j,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),(0,l.jsxs)("select",{value:f,onChange:e=>g(e.target.value),className:"px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",children:[(0,l.jsx)("option",{value:"month",children:"\xdaltimo m\xeas"}),(0,l.jsx)("option",{value:"3months",children:"\xdaltimos 3 meses"}),(0,l.jsx)("option",{value:"6months",children:"\xdaltimos 6 meses"}),(0,l.jsx)("option",{value:"year",children:"\xdaltimo ano"}),(0,l.jsx)("option",{value:"all",children:"Todos"})]})]})}),(0,l.jsx)("div",{className:"space-y-4",children:0===b.length?(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-16 text-center",children:[(0,l.jsx)(x.Z,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-lg font-medium text-slate-700 mb-2",children:"Nenhum servi\xe7o encontrado"}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"Tente ajustar os filtros ou per\xedodo"})]}):b.map(s=>(0,l.jsxs)("div",{onClick:()=>e.push("/service-orders/".concat(s.id)),className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-6 hover:shadow-lg transition-all cursor-pointer",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:"font-bold text-slate-900",children:s.order_number}),(0,l.jsx)("span",{className:"px-2.5 py-0.5 bg-green-100 text-green-800 text-xs font-bold rounded-full",children:"Conclu\xeddo"})]}),(0,l.jsx)("h3",{className:"text-lg font-bold text-slate-900",children:s.title})]}),s.final_cost&&(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"Valor"}),(0,l.jsxs)("p",{className:"text-xl font-bold text-green-600",children:["R$ ",s.final_cost.toFixed(2)]})]})]}),(0,l.jsx)("div",{className:"flex items-center justify-between text-sm text-slate-600",children:(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[s.technician&&(0,l.jsxs)("span",{children:["\uD83D\uDC64 ",s.technician.full_name]}),(0,l.jsxs)("span",{children:["\uD83D\uDCC5 ",new Date(s.completed_at).toLocaleDateString("pt-BR")]})]})})]},s.id))})]})]})}u.kL.register(u.uw,u.f$,u.od,u.jn,u.Dx,u.u,u.De)},5922:function(e,s,t){"use strict";t.d(s,{O:function(){return l}});let l=(0,t(6932).eI)("https://xgcpfxzlzretwsjhvbtt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhnY3BmeHpsenJldHdzamh2YnR0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMjgyODEsImV4cCI6MjA4MDgwNDI4MX0.uG-WI56U7TUkkZogpofgbm8VH55RYOHe1y1hQRpUMgc")}},function(e){e.O(0,[674,896,510,971,938,560],function(){return e(e.s=9631)}),_N_E=e.O()}]);