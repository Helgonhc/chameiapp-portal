(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[117],{2898:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var s=r(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),o=(e,t)=>{let r=(0,s.forwardRef)(({color:r="currentColor",size:o=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:d="",children:c,...m},x)=>(0,s.createElement)("svg",{ref:x,...a,width:o,height:o,stroke:r,strokeWidth:i?24*Number(n)/Number(o):n,className:["lucide",`lucide-${l(e)}`,d].join(" "),...m},[...t.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(c)?c:[c]]));return r.displayName=`${e}`,r}},1981:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2898).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},3067:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3008:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2104:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2898).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},3501:function(e,t,r){Promise.resolve().then(r.bind(r,4828))},4828:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var s=r(7437),a=r(2265),l=r(4033),o=r(5922),n=r(1981),i=r(3067),d=r(3008),c=r(2104);function m(){let e=(0,l.useRouter)(),t=(0,l.useParams)().id,[r,m]=(0,a.useState)(!0),[x,u]=(0,a.useState)(null),[b,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)(""),[j,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)("");async function y(){let{data:{user:t}}=await o.O.auth.getUser();t||e.push("/login")}async function g(){try{m(!0);let{data:e,error:r}=await o.O.from("quotes").select("*").eq("id",t).single();if(r)throw r;let{data:s,error:a}=await o.O.from("quote_items").select("*").eq("quote_id",t).order("sort_order");if(a)throw a;u({...e,items:s||[]})}catch(e){console.error("Erro ao carregar or\xe7amento:",e),w("Erro ao carregar or\xe7amento")}finally{m(!1)}}async function k(){if(confirm("Tem certeza que deseja aprovar este or\xe7amento?")){h(!0);try{let{error:e}=await o.O.from("quotes").update({status:"approved",approved_at:new Date().toISOString()}).eq("id",t);if(e)throw e;alert("✅ Or\xe7amento aprovado com sucesso! Nossa equipe entrar\xe1 em contato em breve."),await g()}catch(e){console.error("Erro ao aprovar:",e),alert("Erro ao aprovar or\xe7amento")}finally{h(!1)}}}async function _(){if(!p.trim()){alert("Por favor, informe o motivo da rejei\xe7\xe3o");return}h(!0);try{let{error:e}=await o.O.from("quotes").update({status:"rejected",rejected_at:new Date().toISOString(),rejection_reason:p.trim()}).eq("id",t);if(e)throw e;alert("Or\xe7amento rejeitado. Obrigado pelo feedback!"),N(!1),await g()}catch(e){console.error("Erro ao rejeitar:",e),alert("Erro ao rejeitar or\xe7amento")}finally{h(!1)}}function O(){return x&&new Date(x.valid_until)<new Date}return(0,a.useEffect)(()=>{y(),g()},[t]),r?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):v||!x?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 px-4",children:(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl p-8 max-w-md text-center border border-slate-200/60",children:[(0,s.jsx)(n.Z,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Erro"}),(0,s.jsx)("p",{className:"text-slate-600 mb-4",children:v||"Or\xe7amento n\xe3o encontrado"}),(0,s.jsx)("button",{onClick:()=>e.push("/quotes"),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Voltar aos Or\xe7amentos"})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[(0,s.jsx)("header",{className:"bg-white/80 backdrop-blur-xl border-b border-slate-200/60 sticky top-0 z-50",children:(0,s.jsx)("div",{className:"max-w-5xl mx-auto px-6 py-4",children:(0,s.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"font-medium",children:"Voltar"})]})})}),(0,s.jsxs)("main",{className:"max-w-5xl mx-auto px-6 py-8",children:[(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-8 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-mono text-slate-500 mb-2",children:x.quote_number}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:x.title}),x.description&&(0,s.jsx)("p",{className:"text-slate-600",children:x.description})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"V\xe1lido at\xe9"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-slate-900",children:new Date(x.valid_until).toLocaleDateString("pt-BR")}),O()&&(0,s.jsx)("span",{className:"inline-block mt-2 text-xs px-2 py-1 bg-red-100 text-red-700 rounded-full font-medium",children:"Expirado"})]})]}),"pending"!==x.status&&(0,s.jsx)("div",{className:"p-4 rounded-xl border-l-4 ".concat("approved"===x.status?"bg-emerald-50 border-emerald-500":"bg-red-50 border-red-500"),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["approved"===x.status?(0,s.jsx)(d.Z,{className:"w-6 h-6 text-emerald-600"}):(0,s.jsx)(c.Z,{className:"w-6 h-6 text-red-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold ".concat("approved"===x.status?"text-emerald-900":"text-red-900"),children:"approved"===x.status?"Or\xe7amento Aprovado":"Or\xe7amento Rejeitado"}),(0,s.jsx)("p",{className:"text-sm ".concat("approved"===x.status?"text-emerald-700":"text-red-700"),children:"approved"===x.status?"Nossa equipe entrar\xe1 em contato em breve para dar continuidade":x.rejection_reason||"Obrigado pelo feedback"})]})]})})]}),(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-8 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Itens do Or\xe7amento"}),(0,s.jsx)("div",{className:"space-y-4",children:x.items.map(e=>{var t;return(0,s.jsxs)("div",{className:"border border-slate-200 rounded-xl p-5 hover:border-slate-300 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-slate-900",children:e.name}),(0,s.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium ".concat({service:"bg-blue-100 text-blue-700",material:"bg-purple-100 text-purple-700",labor:"bg-amber-100 text-amber-700"}[e.item_type]||"bg-gray-100 text-gray-700"),children:{service:"Servi\xe7o",material:"Material",labor:"M\xe3o de Obra"}[t=e.item_type]||t})]}),e.description&&(0,s.jsx)("p",{className:"text-sm text-slate-600",children:e.description})]}),(0,s.jsx)("div",{className:"text-right ml-4",children:(0,s.jsx)("p",{className:"text-lg font-bold text-slate-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.total)})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[(0,s.jsxs)("span",{children:["Qtd: ",e.quantity]}),(0,s.jsx)("span",{children:"•"}),(0,s.jsxs)("span",{children:["Valor unit\xe1rio: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.unit_price)]})]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-8 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Resumo Financeiro"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between text-slate-700",children:[(0,s.jsx)("span",{children:"Subtotal"}),(0,s.jsx)("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x.subtotal)})]}),x.discount>0&&(0,s.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[(0,s.jsxs)("span",{children:["Desconto ","percentage"===x.discount_type?"(".concat(x.discount,"%)"):""]}),(0,s.jsxs)("span",{className:"font-medium",children:["- ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format("percentage"===x.discount_type?x.subtotal*x.discount/100:x.discount)]})]}),x.tax>0&&(0,s.jsxs)("div",{className:"flex justify-between text-slate-700",children:[(0,s.jsx)("span",{children:"Impostos"}),(0,s.jsx)("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x.tax)})]}),(0,s.jsx)("div",{className:"border-t border-slate-200 pt-3 mt-3",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-lg font-bold text-slate-900",children:"Total"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x.total)})]})})]})]}),(x.notes||x.terms)&&(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-8 mb-6",children:[x.notes&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-slate-900 mb-2",children:"Observa\xe7\xf5es"}),(0,s.jsx)("p",{className:"text-slate-600 whitespace-pre-wrap",children:x.notes})]}),x.terms&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-slate-900 mb-2",children:"Termos e Condi\xe7\xf5es"}),(0,s.jsx)("p",{className:"text-slate-600 whitespace-pre-wrap text-sm",children:x.terms})]})]}),"pending"===x.status&&!O()&&(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-sm border border-slate-200/60 p-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-4",children:"A\xe7\xf5es"}),(0,s.jsx)("p",{className:"text-slate-600 mb-6",children:"Revise o or\xe7amento e escolha uma das op\xe7\xf5es abaixo:"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>N(!0),disabled:b,className:"flex-1 px-6 py-4 border-2 border-red-300 text-red-700 rounded-2xl font-semibold hover:bg-red-50 transition-all duration-200 disabled:opacity-50",children:"Rejeitar Or\xe7amento"}),(0,s.jsxs)("button",{onClick:k,disabled:b,className:"flex-1 group relative px-6 py-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-2xl font-semibold hover:from-emerald-700 hover:to-teal-700 disabled:opacity-50 transition-all duration-300 shadow-lg hover:shadow-2xl overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"}),(0,s.jsx)("div",{className:"relative flex items-center justify-center gap-2",children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),(0,s.jsx)("span",{children:"Processando..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Aprovar Or\xe7amento"})]})})]})]})]})]}),j&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-slate-900 mb-4",children:"Rejeitar Or\xe7amento"}),(0,s.jsx)("p",{className:"text-slate-600 mb-4",children:"Por favor, informe o motivo da rejei\xe7\xe3o para que possamos melhorar:"}),(0,s.jsx)("textarea",{value:p,onChange:e=>f(e.target.value),placeholder:"Ex: Valor acima do esperado, prazo muito longo, etc.",rows:4,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none mb-4"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>N(!1),disabled:b,className:"flex-1 px-4 py-3 border border-slate-300 text-slate-700 rounded-xl font-medium hover:bg-slate-50 transition-colors",children:"Cancelar"}),(0,s.jsx)("button",{onClick:_,disabled:b||!p.trim(),className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 transition-colors disabled:opacity-50",children:b?"Rejeitando...":"Confirmar Rejei\xe7\xe3o"})]})]})})]})}},5922:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var s=r(6932),a=r(2601);let l=a.env.NEXT_PUBLIC_SUPABASE_URL,o=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,n=(0,s.eI)(l,o)}},function(e){e.O(0,[896,971,938,560],function(){return e(e.s=3501)}),_N_E=e.O()}]);